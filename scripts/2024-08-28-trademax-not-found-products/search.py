from dataclasses import dataclass
import datetime
import json
import re
import time
from typing import Optional
import requests
import os

import structlog

# import pytest


# PUT TRADEMAX SKU TO SCRAPE HERE
missing_skus = [
    "SYN0008147",
    "2009777",
    "SYN0008996",
    "SYN0009111",
    "1139274",
    "SYN0009134",
    "SYN0010149",
    "675354",
    "SYN0008413",
    "SYN0009690",
    "SYN0010030",
    "2295469",
    "SYN0008200",
    "1475184",
    "SYN0010415",
    "SYN0010431",
    "2297537",
    "SYN0010312",
    "SYN0010442",
    "2160879",
    "SYN0010176",
    "SYN0010223",
    "SYN0008999",
    "SYN0009951",
    "847956",
    "2295521",
    "847995",
    "SYN0009947",
    "SYN0010219",
    "2295499",
    "HFN0012444",
    "SYN0009836",
    "HFN0012439",
    "SYN0009986",
    "SYN0010551",
    "SYN0010207",
    "SYN0010179",
    "848003",
    "SYN0008769",
    "160819",
    "SYN0009987",
    "847782",
    "SYN0009737",
    "SYN0010378",
    "1475295",
    "SYN0009974",
    "SYN0010381",
    "SYN0008886",
    "1382043",
    "SYN0009028",
    "SYN0009801",
    "2295494",
    "1475230",
    "SYN0010257",
    "SYN0010243",
    "SYN0008332",
    "SYN0009101",
    "SYN0009902",
    "2270030",
    "SYN0010038",
    "847975",
    "1209460",
    "577149",
    "2295488",
    "SYN0008529",
    "535555",
    "2229716",
    "SYN0009988",
    "SYN0009990",
    "SYN0009120",
    "SYN0010473",
    "SYN0010013",
    "SYN0009210",
    "SYN0009699",
    "SYN0008534",
    "SYN0010311",
    "SYN0009868",
    "SYN0008468",
    "SYN0009989",
    "SYN0010511",
    "2297547",
    "SYN0010531",
    "SYN0010512",
    "SYN0010186",
    "847761",
    "847765",
    "848011",
    "2295463",
    "SYN0008966",
    "2009800",
    "952388",
    "SYN0009781",
    "SYN0010538",
    "2295508",
    "SYN0010166",
    "SYN0009279",
    "SYN0009032",
    "SYN0010453",
    "SYN0010007",
    "SYN0010185",
    "2295467",
    "SYN0010553",
    "SYN0009474",
    "SYN0010043",
    "SYN0009980",
    "2223348",
    "847755",
    "2295520",
    "847803",
    "952133",
    "SYN0009416",
    "SYN0010455",
    "SYN0009009",
    "SYN0009811",
    "SYN0009287",
    "SYN0009959",
    "SYN0009842",
    "577165",
    "SYN0010006",
    "SYN0010364",
    "SYN0010416",
    "SYN0009970",
    "SYN0008213",
    "SYN0010167",
    "SYN0010394",
    "HFN0012477",
    "SYN0009373",
    "SYN0010579",
    "SYN0009985",
    "2295505",
    "SYN0010556",
    "535560",
    "848008",
    "SYN0009929",
    "SYN0004019",
    "SYN0009394",
    "SYN0009047",
    "SYN0009964",
    "SYN0009731",
    "SYN0008979",
    "2207748",
    "SYN0009841",
    "SYN0008198",
    "1475228",
    "SYN0009819",
    "576501",
    "SYN0009732",
    "1322447",
    "SYN0009834",
    "SYN0010376",
    "SYN0009930",
    "2060341",
    "847822",
    "2295535",
    "SYN0010147",
    "SYN0010117",
    "SYN0009757",
    "SYN0010137",
    "1382056",
    "2295531",
    "1382057",
    "SYN0008238",
    "SYN0010227",
    "1209472",
    "847859",
    "847904",
    "SYN0003847",
    "SYN0009164",
    "SYN0009968",
    "SYN0010345",
    "SYN0008318",
    "2297535",
    "SYN0009542",
    "SYN0010488",
    "SYN0009075",
    "SYN0010480",
    "657311",
    "SYN0009948",
    "847986",
    "2223373",
    "SYN0009995",
    "SYN0008404",
    "847968",
    "2295515",
    "SYN0010421",
    "847791",
    "SYN0009131",
    "1139266",
    "1975742",
    "SYN0008522",
    "678752",
    "2223375",
    "848017",
    "SYN0009864",
    "SYN0009424",
    "SYN0009950",
    "1983230",
    "SYN0009512",
    "2223352",
    "SYN0010031",
    "2297562",
    "SYN0008345",
    "1973304",
    "SYN0008219",
    "SYN0009485",
    "SYN0008233",
    "SYN0010506",
    "SYN0009945",
    "1509863",
    "2295511",
    "SYN0009107",
    "SYN0008310",
    "SYN0009383",
    "847915",
    "SYN0010575",
    "2205374",
    "SYN0010220",
    "SYN0008980",
    "SYN0010569",
    "SYN0010469",
    "SYN0008182",
    "1381974",
    "HFN0012416",
    "1322582",
    "SYN0010319",
    "HFN0012437",
    "SYN0009216",
    "SYN0008143",
    "SYN0008055",
    "852254",
    "SYN0008973",
    "HFN0012440",
    "2223320",
    "SYN0008478",
    "657312",
    "SYN0008409",
    "2009860",
    "SYN0010123",
    "SYN0009070",
    "2060345",
    "SYN0007656",
    "SYN0008063",
    "SYN0010235",
    "SYN0010493",
    "SYN0010233",
    "HFN0012473",
    "SYN0009782",
    "SYN0009106",
    "HFN0012389",
    "SYN0009809",
    "2223356",
    "SYN0009745",
    "SYN0010393",
    "SYN0009961",
    "SYN0009904",
    "SYN0009145",
    "SYN0009173",
    "SYN0008346",
    "841143",
    "HFN0012436",
    "SYN0010154",
    "SYN0003904",
    "675342",
    "SYN0007644",
    "SYN0009766",
    "1322567",
    "SYN0009481",
    "SYN0009830",
    "SYN0009158",
    "2223355",
    "SYN0004012",
    "524324",
    "1209494",
    "SYN0009015",
    "SYN0010287",
    "847764",
    "SYN0010429",
    "SYN0009759",
    "SYN0008179",
    "535558",
    "1395877",
    "1509894",
    "2295484",
    "SYN0009477",
    "SYN0004115",
    "1322460",
    "SYN0007661",
    "SYN0008476",
    "2295471",
    "1983235",
    "SYN0009927",
    "HFN0012438",
    "SYN0010338",
    "SYN0010465",
    "SYN0010490",
    "847971",
    "678785",
    "847868",
    "848007",
    "2295498",
    "SYN0010361",
    "1475263",
    "SYN0009785",
    "SYN0010094",
    "SYN0003927",
    "SYN0008621",
    "2297575",
    "SYN0010396",
    "SYN0010294",
    "SYN0009869",
    "SYN0010141",
    "SYN0010503",
    "2295481",
    "SYN0008312",
    "952357",
    "SYN0010258",
    "SYN0010190",
    "SYN0009783",
    "SYN0008311",
    "SYN0009179",
    "SYN0010327",
    "SYN0009558",
    "SYN0003797",
    "2009881",
    "SYN0009083",
    "1322471",
    "1382062",
    "SYN0009150",
    "SYN0010334",
    "2297553",
    "SYN0010310",
    "SYN0010460",
    "SYN0008159",
    "SYN0009142",
    "SYN0010505",
    "SYN0009787",
    "1973291",
    "SYN0009702",
    "SYN0010159",
    "SYN0008336",
    "SYN0010368",
    "SYN0009113",
    "SYN0010397",
    "SYN0010040",
    "SYN0009709",
    "2295506",
    "SYN0009059",
    "2295474",
    "SYN0009223",
    "SYN0010521",
    "SYN0009454",
    "SYN0010230",
    "SYN0008322",
    "1209432",
    "SYN0008209",
    "2223376",
    "SYN0010548",
    "SYN0009103",
    "SYN0010217",
    "SYN0009042",
    "SYN0008303",
    "847819",
    "SYN0010145",
    "2295468",
    "657319",
    "2009872",
    "SYN0010255",
    "SYN0009072",
    "577160",
    "SYN0009780",
    "577132",
    "SYN0010404",
    "SYN0008294",
    "SYN0010386",
    "SYN0010328",
    "SYN0010561",
    "SYN0008149",
    "847773",
    "SYN0010181",
    "847875",
    "678749",
    "2223371",
    "SYN0008660",
    "1209464",
    "2295490",
    "SYN0010011",
    "SYN0009480",
    "SYN0003770",
    "SYN0010523",
    "SYN0008651",
    "847794",
    "2295502",
    "1475242",
    "SYN0009497",
    "SYN0009001",
    "SYN0010199",
    "SYN0008730",
    "SYN0010206",
    "SYN0008212",
    "SYN0008960",
    "SYN0010193",
    "SYN0010068",
    "1392989",
    "SYN0010492",
    "SYN0009030",
    "SYN0010384",
    "SYN0009954",
    "SYN0008983",
    "SYN0010323",
    "SYN0009700",
    "SYN0010184",
    "SYN0009190",
    "SYN0009983",
    "847955",
    "SYN0009005",
    "SYN0009856",
    "SYN0010221",
    "SYN0010017",
    "SYN0009717",
    "SYN0009010",
    "SYN0009824",
    "1382035",
    "2297536",
    "SYN0009112",
    "SYN0010352",
    "SYN0010276",
    "SYN0009996",
    "SYN0009023",
    "1475238",
    "SYN0009021",
    "SYN0009479",
    "2295493",
    "2009707",
    "952128",
    "SYN0009151",
    "HFN0012426",
    "SYN0009214",
    "SYN0009739",
    "1322456",
    "SYN0010245",
    "SYN0008199",
    "SYN0008296",
    "SYN0009863",
    "SYN0010570",
    "SYN0009116",
    "SYN0009147",
    "SYN0010545",
    "1209437",
    "SYN0009016",
    "1209519",
    "SYN0009044",
    "SYN0009810",
    "SYN0009138",
    "SYN0009161",
    "SYN0009320",
    "SYN0009816",
    "1139272",
    "2009802",
    "SYN0009403",
    "SYN0009912",
    "SYN0009539",
    "SYN0009767",
    "SYN0008817",
    "2223329",
    "SYN0010417",
    "SYN0010499",
    "SYN0008408",
    "SYN0010168",
    "SYN0010350",
    "577146",
    "SYN0008433",
    "848014",
    "SYN0009802",
    "688108",
    "576495",
    "SYN0009176",
    "SYN0007682",
    "2295507",
    "2295492",
    "SYN0009751",
    "SYN0010273",
    "SYN0009135",
    "SYN0010143",
    "SYN0010016",
    "SYN0007660",
    "847988",
    "SYN0008215",
    "1382072",
    "1209447",
    "2295501",
    "SYN0009149",
    "847838",
    "SYN0010389",
    "SYN0010239",
    "2295517",
    "SYN0009234",
    "SYN0010481",
    "SYN0009925",
    "2295537",
    "SYN0009799",
    "SYN0010124",
    "SYN0009488",
    "SYN0010372",
    "SYN0008964",
    "SYN0009941",
    "SYN0009701",
    "SYN0009858",
    "SYN0009708",
    "852242",
    "SYN0009034",
    "1209512",
    "2295472",
    "SYN0003839",
    "SYN0010208",
    "1209450",
    "SYN0009008",
    "2295476",
    "2295527",
    "SYN0010237",
    "SYN0008419",
    "SYN0010172",
    "2223326",
    "847958",
    "852245",
    "SYN0008230",
    "SYN0008993",
    "SYN0010560",
    "SYN0010120",
    "SYN0010119",
    "2009863",
    "1381982",
    "847945",
    "SYN0007696",
    "SYN0008971",
    "2295529",
    "SYN0010477",
    "SYN0009937",
    "SYN0009242",
    "SYN0010138",
    "1209498",
    "SYN0008297",
    "SYN0009091",
    "SYN0010010",
    "SYN0008606",
    "SYN0009038",
    "SYN0010533",
    "1836825",
    "SYN0010085",
    "SYN0003775",
    "SYN0009772",
    "SYN0010244",
    "SYN0009122",
    "535402",
    "SYN0008918",
    "2297563",
    "SYN0009203",
    "535392",
    "SYN0009187",
    "SYN0010371",
    "SYN0010452",
    "SYN0009057",
    "535553",
    "2297577",
    "SYN0009958",
    "SYN0010052",
    "847871",
    "SYN0009774",
    "SYN0009867",
    "577161",
    "SYN0010248",
    "SYN0010202",
    "SYN0010314",
    "SYN0010544",
    "SYN0008624",
    "SYN0008323",
    "SYN0010251",
    "SYN0010515",
    "SYN0009065",
    "SYN0010413",
    "SYN0008874",
    "2009795",
    "SYN0009039",
    "1209483",
    "577138",
    "SYN0009875",
    "SYN0010139",
    "SYN0009946",
    "2295500",
    "SYN0009795",
    "2297573",
    "SYN0010407",
    "HFN0012457",
    "SYN0008466",
    "847873",
    "SYN0009763",
    "SYN0009943",
    "688111",
    "SYN0010305",
    "SYN0008141",
    "576474",
    "847896",
    "SYN0008997",
    "798466",
    "SYN0009742",
    "675352",
    "847857",
    "SYN0009453",
    "1983231",
    "SYN0009117",
    "SYN0010542",
    "SYN0008180",
    "SYN0009754",
    "1381963",
    "HFN0012458",
    "1798527",
    "SYN0010566",
    "847913",
    "SYN0010000",
    "SYN0009175",
    "1382083",
    "798468",
    "SYN0010339",
    "847972",
    "SYN0010434",
    "HFN0012423",
    "2297545",
    "2009859",
    "SYN0010053",
    "SYN0009193",
    "SYN0009002",
    "847754",
    "SYN0008401",
    "SYN0010385",
    "SYN0009845",
    "SYN0010246",
    "SYN0008151",
    "SYN0010036",
    "SYN0009080",
    "SYN0009776",
    "SYN0008333",
    "SYN0010354",
    "2295473",
    "688109",
    "2009877",
    "SYN0010027",
    "1475315",
    "SYN0009090",
    "2223359",
    "SYN0009940",
    "SYN0010374",
    "678742",
    "SYN0010373",
    "SYN0009389",
    "SYN0009975",
    "545678",
    "SYN0010425",
    "SYN0010441",
    "SYN0010524",
    "SYN0009162",
    "SYN0010317",
    "SYN0009143",
    "SYN0008316",
    "2295464",
    "SYN0010309",
    "SYN0010522",
    "SYN0008192",
    "SYN0008144",
    "952092",
    "SYN0010228",
    "SYN0009808",
    "678787",
    "SYN0008636",
    "2269209",
    "2270040",
    "SYN0008469",
    "SYN0009850",
    "1973280",
    "SYN0009078",
    "SYN0009735",
    "1382041",
    "2295522",
    "SYN0009753",
    "577174",
    "SYN0009037",
    "SYN0010095",
    "1509868",
    "SYN0009017",
    "2295512",
    "SYN0009982",
    "SYN0009029",
    "576493",
    "SYN0008165",
    "SYN0009832",
    "SYN0009110",
    "SYN0009128",
    "SYN0009307",
    "847775",
    "SYN0009020",
    "SYN0009013",
    "SYN0010231",
    "SYN0008663",
    "SYN0009728",
    "SYN0010249",
    "847889",
    "SYN0009932",
    "SYN0009098",
    "SYN0010197",
    "535391",
    "SYN0008699",
    "SYN0007652",
    "SYN0010437",
    "524364",
    "1382002",
    "2295538",
    "SYN0009791",
    "SYN0009984",
    "SYN0010014",
    "SYN0009185",
    "SYN0010419",
    "SYN0008407",
    "SYN0009052",
    "SYN0008331",
    "SYN0008475",
    "SYN0009012",
    "SYN0007727",
    "SYN0004112",
    "2295479",
    "2223345",
    "535554",
    "SYN0009062",
    "1475180",
    "SYN0009778",
    "SYN0009960",
    "847897",
    "SYN0010171",
    "952368",
    "2223367",
    "SYN0009040",
    "SYN0009725",
    "SYN0009353",
    "SYN0010099",
    "SYN0008479",
    "SYN0009450",
    "952138",
    "SYN0009855",
    "2295532",
    "SYN0009049",
    "SYN0010463",
    "1209508",
    "SYN0008738",
    "SYN0010379",
    "SYN0008970",
    "1209497",
    "HFN0012413",
    "SYN0008967",
    "2295514",
    "SYN0010295",
    "SYN0010225",
    "1209471",
    "1322579",
    "SYN0010324",
    "SYN0010118",
    "SYN0009166",
    "SYN0010436",
    "SYN0010187",
    "SYN0010517",
    "SYN0009227",
    "SYN0009061",
    "SYN0010541",
    "SYN0008315",
    "SYN0004126",
    "SYN0009813",
    "SYN0009093",
    "2295539",
    "SYN0009219",
    "SYN0009014",
    "SYN0009957",
    "688114",
    "SYN0009543",
    "2295478",
    "2295516",
    "SYN0009691",
    "2009806",
    "SYN0010012",
    "577163",
    "847893",
    "2297534",
    "SYN0008325",
    "SYN0009936",
    "1382025",
    "1382047",
    "688115",
    "524377",
    "SYN0009846",
    "SYN0010278",
    "SYN0009862",
    "2295460",
    "SYN0009102",
    "841121",
    "SYN0008410",
    "SYN0008153",
    "SYN0009439",
    "SYN0008994",
    "SYN0009036",
    "678788",
    "SYN0010367",
    "SYN0009056",
    "535559",
    "SYN0010403",
    "535153",
    "SYN0010401",
    "SYN0008229",
    "2295523",
    "SYN0009043",
    "SYN0009100",
    "SYN0003957",
    "SYN0010329",
    "1209515",
    "SYN0009991",
    "SYN0009491",
    "SYN0009129",
    "SYN0009228",
    "SYN0009096",
    "SYN0004117",
    "1382069",
    "SYN0009118",
    "SYN0008210",
    "SYN0010022",
    "2009867",
    "2297546",
    "SYN0008231",
    "2297567",
    "SYN0010194",
    "SYN0009833",
    "SYN0010132",
    "SYN0008959",
    "SYN0009768",
    "2295524",
    "SYN0009548",
    "SYN0009011",
    "SYN0009121",
    "SYN0009025",
    "2297559",
    "SYN0009726",
    "2295495",
    "SYN0009931",
    "SYN0004130",
    "2295536",
    "2295533",
    "SYN0010285",
    "SYN0009183",
    "SYN0010484",
    "2295462",
    "SYN0009837",
    "SYN0009094",
    "1983221",
    "SYN0009207",
    "1322470",
    "SYN0010252",
    "SYN0010448",
    "SYN0010192",
    "2297581",
    "SYN0003844",
    "2009815",
    "SYN0009764",
    "SYN0010018",
    "SYN0009492",
    "2223338",
    "SYN0010308",
    "SYN0009760",
    "SYN0009126",
    "SYN0010282",
    "SYN0010530",
    "SYN0009467",
    "952141",
    "SYN0010057",
    "678790",
    "577133",
    "SYN0010261",
    "SYN0009740",
    "SYN0009547",
    "SYN0009349",
    "1382003",
    "SYN0009729",
    "SYN0010405",
    "SYN0010039",
    "SYN0009051",
    "SYN0010430",
    "2295470",
    "1209493",
    "SYN0009077",
    "SYN0009060",
    "SYN0010418",
    "SYN0009498",
    "847763",
    "SYN0009379",
    "HFN0012447",
    "SYN0008984",
    "SYN0009055",
    "1209528",
    "SYN0010116",
    "1979954",
    "SYN0008723",
    "SYN0009144",
    "2160878",
    "SYN0009206",
    "SYN0008150",
    "HFN0012402",
    "SYN0009084",
    "SYN0009924",
    "SYN0009139",
    "SYN0008968",
    "SYN0010514",
    "SYN0009208",
    "577139",
    "2297544",
    "SYN0010205",
    "SYN0009095",
    "SYN0008527",
    "SYN0010502",
    "SYN0009418",
    "SYN0009007",
    "SYN0010546",
    "2297538",
    "2297540",
    "1983217",
    "SYN0009115",
    "SYN0010440",
    "SYN0007599",
    "SYN0009181",
    "2295477",
    "SYN0008777",
    "688113",
    "952370",
    "SYN0008402",
    "SYN0009714",
    "SYN0004132",
    "SYN0010478",
    "SYN0010126",
    "SYN0009233",
    "2297548",
    "SYN0009998",
    "SYN0009966",
    "2295530",
    "SYN0010540",
    "SYN0010474",
    "852244",
    "1209514",
    "847807",
    "SYN0009081",
    "SYN0009981",
    "2295497",
    "SYN0009099",
    "1392987",
    "1855479",
    "2295525",
    "SYN0009514",
    "SYN0009189",
    "SYN0009977",
    "SYN0008406",
    "SYN0009079",
    "1475317",
    "SYN0008981",
    "852249",
    "SYN0008235",
    "SYN0004134",
    "SYN0009939",
    "SYN0010229",
    "577150",
    "SYN0010497",
    "1381993",
    "SYN0010300",
    "SYN0010358",
    "841140",
    "SYN0010142",
    "SYN0003932",
    "SYN0010127",
    "SYN0004084",
    "SYN0004151",
    "2297576",
    "SYN0010026",
    "1509875",
    "SYN0010277",
    "2297539",
    "SYN0009446",
    "SYN0009191",
    "SYN0008989",
    "SYN0010518",
    "SYN0008301",
    "848005",
    "SYN0009050",
    "SYN0010051",
    "SYN0010444",
    "SYN0004146",
    "SYN0009033",
    "1209496",
    "SYN0010400",
    "SYN0009500",
    "SYN0008589",
    "SYN0008236",
    "2223346",
    "SYN0009019",
    "SYN0008411",
    "SYN0010362",
    "SYN0009455",
    "SYN0009933",
    "SYN0004098",
    "2295475",
    "SYN0010063",
    "SYN0009171",
    "SYN0010409",
    "SYN0010489",
    "SYN0010156",
    "SYN0009777",
    "SYN0010335",
    "SYN0008178",
    "2297542",
    "SYN0009148",
    "2295485",
    "HFN0012422",
    "SYN0010035",
    "SYN0009847",
    "SYN0010558",
    "SYN0009125",
    "SYN0010395",
    "SYN0010526",
    "SYN0008375",
    "SYN0010485",
    "2297541",
    "SYN0010182",
    "SYN0010238",
    "SYN0010365",
    "SYN0010140",
    "SYN0009006",
    "SYN0009133",
    "HFN0012411",
    "SYN0009978",
    "2295518",
    "SYN0003855",
    "SYN0009063",
    "847906",
    "SYN0010529",
    "847925",
    "SYN0009818",
    "647890",
    "SYN0009798",
    "SYN0009178",
    "SYN0008260",
    "SYN0009935",
    "SYN0010343",
    "SYN0009738",
    "SYN0010151",
    "SYN0008381",
    "HFN0012393",
    "SYN0010507",
    "SYN0009469",
    "SYN0009159",
    "SYN0009544",
    "848021",
    "SYN0009041",
    "1898103",
    "847991",
    "2270035",
    "SYN0008326",
    "SYN0008987",
    "1475308",
    "2295509",
    "SYN0010002",
    "1322596",
    "2295528",
    "2295487",
    "SYN0010029",
    "577145",
    "SYN0008729",
    "1975715",
    "1381961",
    "2295513",
    "SYN0010242",
    "847929",
    "2295489",
    "SYN0009000",
    "SYN0008681",
    "SYN0008976",
    "SYN0009046",
    "1381975",
    "SYN0009124",
    "SYN0009071",
    "SYN0010098",
    "SYN0010423",
    "SYN0009226",
    "SYN0007706",
    "SYN0008185",
    "SYN0009944",
    "SYN0010519",
    "SYN0010153",
    "1475208",
    "2269444",
    "847907",
    "SYN0009758",
    "SYN0008152",
    "SYN0009483",
    "SYN0008252",
    "SYN0009068",
    "SYN0008995",
    "SYN0009710",
    "SYN0010262",
    "SYN0010475",
    "2295503",
    "SYN0009883",
    "SYN0009535",
    "2295526",
    "952392",
    "SYN0009109",
    "577164",
    "SYN0009851",
    "SYN0009769",
    "SYN0010268",
    "SYN0010004",
    "SYN0010045",
    "SYN0009993",
    "2270089",
    "SYN0010214",
    "848024",
    "SYN0009154",
    "577159",
    "SYN0010218",
    "847993",
    "SYN0004102",
    "847858",
    "SYN0009069",
    "SYN0009097",
    "847992",
    "SYN0009224",
    "2295510",
    "SYN0009879",
    "2295496",
    "SYN0010005",
    "SYN0009449",
    "SYN0009252",
    "SYN0010341",
    "SYN0008353",
    "SYN0010289",
    "SYN0009066",
    "SYN0009697",
    "SYN0009770",
    "852247",
    "577175",
    "SYN0010264",
    "SYN0010357",
    "SYN0009264",
    "SYN0009045",
    "535395",
    "847748",
    "1209490",
    "SYN0009915",
    "SYN0009825",
    "SYN0009231",
    "SYN0003950",
    "SYN0009804",
    "SYN0009997",
    "SYN0010387",
    "1475233",
    "SYN0009004",
    "SYN0009482",
    "SYN0009087",
    "SYN0003819",
    "SYN0004159",
    "SYN0009074",
    "577162",
    "SYN0008214",
    "SYN0009157",
    "688112",
    "1322583",
    "SYN0008225",
    "SYN0010175",
    "SYN0009218",
    "2009912",
    "SYN0010427",
    "SYN0004067",
    "1983238",
    "SYN0009797",
    "SYN0006211",
    "SYN0010487",
    "2207759",
    "SYN0007662",
    "SYN0009779",
    "848004",
    "678747",
    "SYN0009141",
    "SYN0009130",
    "SYN0008986",
    "SYN0008293",
    "1475195",
    "SYN0010432",
    "SYN0009884",
    "848018",
    "SYN0010390",
    "SYN0010443",
    "SYN0009092",
    "2295483",
    "SYN0009076",
    "SYN0009105",
    "SYN0010180",
    "SYN0009172",
    "2295486",
    "SYN0009058",
    "847987",
    "SYN0008412",
    "SYN0003916",
    "535156",
    "SYN0009956",
    "SYN0009053",
    "SYN0009733",
    "675336",
    "SYN0009953",
    "SYN0008990",
    "SYN0009119",
    "SYN0009064",
    "SYN0010109",
    "SYN0010574",
    "SYN0009537",
    "1209492",
    "2295480",
    "SYN0010150",
    "SYN0008432",
    "SYN0008528",
    "SYN0010410",
    "SYN0009140",
    "SYN0009442",
    "SYN0010479",
    "SYN0010226",
    "847951",
    "SYN0010349",
    "577136",
    "SYN0009315",
    "SYN0010565",
    "1382037",
    "2295466",
    "2009645",
    "SYN0009085",
    "SYN0009971",
    "SYN0009853",
    "SYN0010241",
    "2295461",
    "SYN0010135",
    "SYN0009089",
    "SYN0010313",
    "2160884",
    "SYN0004166",
    "SYN0010259",
    "2207843",
    "577172",
    "SYN0008631",
    "SYN0010125",
    "SYN0010209",
    "2009862",
    "SYN0009896",
    "SYN0009293",
    "678783",
    "1475235",
    "SYN0009048",
    "1005610",
    "2295534",
    "SYN0009177",
    "847780",
    "2295465",
    "SYN0009073",
    "SYN0010215",
    "657310",
    "SYN0009602",
    "SYN0009267",
    "2295482",
    "1973293",
    "SYN0009992",
    "SYN0010366",
    "SYN0010281",
    "160823",
    "SYN0009803",
    "SYN0010009",
    "SYN0010563",
    "2295504",
    "SYN0009225",
    "SYN0008290",
    "SYN0008380",
    "SYN0009792",
    "SYN0009865",
    "SYN0010301",
    "847756",
    "SYN0009314",
    "576498",
    "SYN0009152",
    "SYN0010003",
    "SYN0009067",
    "SYN0009762",
    "SYN0009156",
    "SYN0010346",
    "SYN0009969",
    "SYN0008616",
    "678779",
    "SYN0007693",
    "SYN0010121",
    "SYN0008194",
    "SYN0010081",
    "SYN0010476",
    "848025",
    "SYN0009003",
    "SYN0009538",
    "2295519",
    "847804",
    "SYN0009170",
    "SYN0010111",
    "847767",
    "SYN0009698",
    "SYN0010304",
    "847883",
    "1381973",
    "SYN0009108",
    "SYN0010107",
    "2295491",
    "SYN0009347",
    "SYN0010071",
    "SYN0008250",
    "SYN0009786",
    "SYN0008226",
    "SYN0009515",
    "1382008",
    "SYN0010188",
    "SYN0009031",
    "SYN0010470",
    "SYN0010332",
    "SYN0010316",
    "SYN0010377",
    "576525",
    "2223333",
    "SYN0009860",
    "SYN0010391",
    "2229696",
    "SYN0008991",
    "160833",
    "SYN0009501",
    "SYN0009789",
    "SYN0010001",
]

logger = structlog.get_logger()

DEFAULT_REQUEST_HEADER = {
    "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36"
}


def venture_design_search_url(query: str) -> str:
    return f"https://www.venturedesign.se/search/{query}"


def trademax_search_url(query: str) -> str:
    return f"https://www.trademax.se/search?q={query}"


def trademax_search_by_sku(sku: str) -> Optional[str]:
    """Find the product on Trademax and return the product url"""
    url = trademax_search_url(sku)
    response = requests.get(url, headers=DEFAULT_REQUEST_HEADER)

    if response.status_code >= 300:
        raise Exception(f"Request error, status_code: {response.status_code}")

    html = response.text
    # with open("./tmp.html", "w") as f:
    #     f.write(html)

    # Check to see if we got redirected to a product page:
    if re.search(r"-p\d+", response.url):
        return response.url

    # Check to see if there are any search result:
    if html.find(f'sku_id":"{sku}') == -1:
        return None

    # Find the 1st url as the result:
    pattern = r'"uri":"(\\\/[^"]+)"'
    match = re.search(pattern, html)
    if match:
        uri = match.group(1)
        return "https://www.trademax.se" + uri.replace("\\/", "/")

    return None


# @pytest.mark.skip
# def test_trademax_search_by_sku():
#     products = [
#         {"sku": 1875662},
#         {"sku": 1209935},
#         {"sku": 2266765},
#     ]
#     expect = [
#         "https://www.trademax.se/m%C3%B6bler/stolar/f%C3%A5t%C3%B6ljer/f%C3%A5t%C3%B6lj-rakel-svart-p1730164-v1375662",
#         None,
#         "https://www.trademax.se/utem%C3%B6bler/utomhusgrupp/caf%C3%A9grupp/borneo-cafeset-70-cm-2-st-tablas-matstolar-m%C3%B6rkgr%C3%A5svart-p1766765",
#     ]

#     for i, p in enumerate(products):
#         result = trademax_search_by_sku(str(p["sku"]))
#         print(f"Found product {p['sku']}: {result}")
#         assert result == expect[i]


def main():
    start_time = datetime.datetime.now().isoformat()
    product_found = {}

    for sku in missing_skus:
        product_url = trademax_search_by_sku(sku)
        if product_url is not None:
            logger.info(
                "Product found",
                sku=sku,
                search_url=trademax_search_url(sku),
                url=product_url,
            )
            product_found[sku] = product_url
        else:
            logger.warning(
                "Not found", sku=sku, search_url=trademax_search_url(sku), url=None
            )

        with open(f"product_found_{start_time}.json", "a") as f:
            if product_url:
                f.write(json.dumps(product_url))
                f.write(",\n")

        # Do not scrape too fast
        # time.sleep(0.5)

    print("\nTotal products found:", len(product_found), "out of", len(missing_skus))

    with open("products_found.csv", "w") as f:
        for sku, url in product_found.items():
            f.write(sku)
            f.write(",")
            f.write(url)
            f.write("\n")

    not_found = set([sku for sku in missing_skus]) - set(product_found.keys())
    not_found = list(not_found)

    with open("products_not_found.csv", "w") as f:
        for sku in not_found:
            f.write(sku)
            f.write("\n")


if __name__ == "__main__":
    main()
